version: '3.8'

services:
  hotel-scraper:
    build: .
    container_name: hotel-leads-scraper
    environment:
      # Hotel Project Leads Credentials
      - HPL_USERNAME=${HPL_USERNAME}
      - HPL_PASSWORD=${HPL_PASSWORD}
      
      # Zoho CRM Configuration
      - ZOHO_CLIENT_ID=${ZOHO_CLIENT_ID}
      - ZOHO_CLIENT_SECRET=${ZOHO_CLIENT_SECRET}
      - ZOHO_REFRESH_TOKEN=${ZOHO_REFRESH_TOKEN}
      - ZOHO_REDIRECT_URI=${ZOHO_REDIRECT_URI}
      
      # Scraper Configuration
      - NUM_BROWSERS=${NUM_BROWSERS:-5}
      - HEADLESS=${HEADLESS:-True}
      
      # Scheduler Configuration
      - SCHEDULE_ENABLED=${SCHEDULE_ENABLED:-True}
      - SCHEDULE_DAY_OF_WEEK=${SCHEDULE_DAY_OF_WEEK:-mon}
      - SCHEDULE_HOUR=${SCHEDULE_HOUR:-9}
      - SCHEDULE_MINUTE=${SCHEDULE_MINUTE:-0}
      - SCHEDULE_TIMEZONE=${SCHEDULE_TIMEZONE:-America/New_York}
    
    volumes:
      # Mount lead_downloads directory to persist data
      - ./lead_downloads:/app/lead_downloads
      # Mount logs
      - ./scheduler.log:/app/scheduler.log
      # Mount progress files
      - ./all_lead_links.json:/app/all_lead_links.json
      - ./cookies.json:/app/cookies.json
      - ./download_progress.json:/app/download_progress.json
    
    restart: unless-stopped
    
    # Allocate more resources for parallel browsers
    shm_size: '2gb'
    
    # Health check
    healthcheck:
      test: ["CMD", "python", "-c", "import sys; sys.exit(0)"]
      interval: 30s
      timeout: 10s
      retries: 3












hotel-scraper:
    image: hotel-scraper 

    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.hotel-scraper.entrypoints=websecure"
      - "traefik.http.routers.hotel-scraper.tls.certresolver=lets-encrypt"
      - "traefik.http.routers.hotel-scraper.rule=Host(`hotel-scraper.demo.centrox.ai`)"
      - "traefik.http.services.hotel-scraper.loadbalancer.server.port=8000"
    

    restart: unless-stopped
    networks:
      - proxy